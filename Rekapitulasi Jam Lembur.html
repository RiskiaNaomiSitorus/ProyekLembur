<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Summary</title>
  <link rel="stylesheet" href="styles.css" />
  <script src="https://kit.fontawesome.com/b99e675b6e.js"></script>
  <link
    rel="stylesheet"
    href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css"
  />
  <link
    rel="stylesheet"
    href="https://cdn.datatables.net/1.10.21/css/jquery.dataTables.min.css"
  />
  <link
    rel="stylesheet"
    href="https://cdn.datatables.net/buttons/1.6.2/css/buttons.dataTables.min.css"
  />
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/xlsx/dist/xlsx.full.min.js"></script>
  <script src="https://code.jquery.com/jquery-3.5.1.js"></script>
  <script src="https://cdn.datatables.net/1.10.21/js/jquery.dataTables.min.js"></script>
  <script src="https://cdn.datatables.net/buttons/1.6.2/js/dataTables.buttons.min.js"></script>
  <script src="https://cdn.datatables.net/buttons/1.6.2/js/buttons.print.min.js"></script>
  <script src="https://cdn.datatables.net/buttons/1.6.2/js/buttons.html5.min.js"></script>
  <script src="https://cdn.datatables.net/buttons/1.6.2/js/buttons.colVis.min.js"></script>
  <style>
    .table-container {
      width: 100%;
      margin-left: 5px;
    }
    .table-container table {
      width: 100%;
    }
    .form-container {
      margin: 20px 0;
    }
    .summary-footer {
      margin-top: 20px;
    }
    .bold {
      font-weight: bold;
    }
    .action-buttons {
      margin-bottom: 10px;
    }
    .action-buttons .btn {
      margin-right: 5px;
    }
  </style>
</head>
<body>
  <div class="wrapper">
    <div class="sidebar">
      <h2>Lembur</h2>
      <ul>
        <li>
          <a href="Dashboard.html"><i class="fas fa-home"></i>Dashboard</a>
        </li>
        <li>
          <a href="Data Karyawan.html"><i class="fas fa-user"></i>Data Karyawan</a>
        </li>
        <li>
          <a href="Rekapitulasi Jam Lembur.html"><i class="fas fa-project-diagram"></i>Summary</a>
        </li>
        <li>
          <a href="Perhitungan Lembur.html"><i class="fas fa-address-book"></i>Perhitungan Lembur</a>
        </li>
      </ul>
    </div>
    <div class="main_content">
      <div class="header">
        <div class="title">PT. Tolan Tiga Indonesia</div>
        <div class="user-info">
          <i class="fa fa-bell"></i>
          <div class="profile-picture">
            <img src="assets/img.png" alt="Profile Picture" />
          </div>
          <div class="username">Riskia Sitorus</div>
        </div>
      </div>
      <div class="info">
        <div class="date">
          <h5>12 Juli 2024</h5>
        </div>
      </div>
      <div class="dashboard"></div>
      <div class="header-section">
        <div class="container">
          <h1>Summary Lembur Karyawan</h1>
        </div>

        <div class="form-container">
          <form id="overtime-form">
            <div class="form-group">
              <label for="nama">Nama:</label>
              <input
                type="text"
                id="nama"
                name="nama"
                class="form-control"
                required
              />
            </div>
            <div class="form-group">
              <label for="in">In:</label>
              <input
                type="time"
                id="in"
                name="in"
                class="form-control"
                required
              />
            </div>
            <div class="form-group">
              <label for="out">Out:</label>
              <input
                type="time"
                id="out"
                name="out"
                class="form-control"
                required
              />
            </div>
            <div class="form-group">
              <label for="keterangan">Keterangan:</label>
              <input
                type="text"
                id="keterangan"
                name="keterangan"
                class="form-control"
                required
              />
            </div>
            <button type="submit" class="btn btn-primary">Submit</button>
          </form>
        </div>

        <div class="table-container">
          <table class="table table-striped table-bordered" id="overtime-table">
            <thead>
              <tr>
                <th>No</th>
                <th>Nama</th>
                <th>Jumlah Jam</th>
                <th>Rp</th>
              </tr>
            </thead>
            <tbody id="summary-table">
              <!-- Rows will be inserted here by JavaScript -->
            </tbody>
            <tfoot>
              <tr>
                <td colspan="2">Total</td>
                <td id="total-jam" class="bold">0</td>
                <td id="total-upah" class="bold">0</td>
              </tr>
            </tfoot>
          </table>
        </div>

        <div class="summary-footer">
          <div class="action-buttons">
            <button class="btn btn-primary btn-sm" onclick="exportToExcel()">
              <i class="fas fa-file-excel"></i> Excel
            </button>
            <button id="print-btn" class="btn btn-secondary btn-sm">
              <i class="fas fa-print"></i> Print
            </button>
            <button id="csv-btn" class="btn btn-success btn-sm">
              <i class="fas fa-file-csv"></i> CSV
            </button>
            <button id="copy-btn" class="btn btn-info btn-sm">
              <i class="fas fa-copy"></i> Copy
            </button>
            <button id="colvis-btn" class="btn btn-warning btn-sm">
              <i class="fas fa-eye"></i> Column Visibility
            </button>
          </div>
          <p>Alamat: Jalan Example No.123, Jakarta</p>
          <p>Tanggal: 12 Juli 2024</p>
          <p>Approved by: Manager Name</p>
        </div>
      </div>
    </div>
  </div>
  <script>
    // Data lembur
    const overtimeData = [];

    // Function untuk menghitung lembur
    function calculateOvertime(inTime, outTime) {
      const inParts = inTime.split(":");
      const outParts = outTime.split(":");
      const inDate = new Date(0, 0, 0, inParts[0], inParts[1], 0);
      const outDate = new Date(0, 0, 0, outParts[0], outParts[1], 0);
      const diff = outDate.getTime() - inDate.getTime();
      const hours = Math.floor(diff / 1000 / 60 / 60);
      const minutes = Math.floor((diff - hours * 60 * 60 * 1000) / 1000 / 60);
      const totalHours = hours + minutes / 60;

      const jam1 = Math.min(totalHours, 1);
      const jam2 = totalHours > 1 ? Math.min(totalHours - 1, 1) : 0;
      const jam9 = totalHours > 2 ? Math.min(totalHours - 2, 1) : 0;
      const jam10 = totalHours > 3 ? totalHours - 3 : 0;

      const totalLembur = jam1 + jam2 + jam9 + jam10;
      const upahLembur = (jam1 * 1.5 + jam2 * 2 + jam9 * 3 + jam10 * 4) * 21803;

      return { totalLembur, upahLembur };
    }

    // Function untuk mengisi tabel
    function populateSummaryTable(data) {
      const tableBody = document.getElementById("summary-table");
      tableBody.innerHTML = ""; // Clear existing rows
      let totalJam = 0;
      let totalUpah = 0;

      data.forEach((item, index) => {
        const row = document.createElement("tr");

        const cellNo = document.createElement("td");
        cellNo.textContent = index + 1;
        row.appendChild(cellNo);

        const cellNama = document.createElement("td");
        cellNama.textContent = item.nama;
        row.appendChild(cellNama);

        const cellJam = document.createElement("td");
        cellJam.textContent = item.totalLembur.toFixed(2);
        row.appendChild(cellJam);

        const cellRp = document.createElement("td");
        cellRp.textContent = item.upahLembur.toFixed(2);
        row.appendChild(cellRp);

        tableBody.appendChild(row);

        totalJam += item.totalLembur;
        totalUpah += item.upahLembur;
      });

      document.getElementById("total-jam").textContent = totalJam.toFixed(2);
      document.getElementById("total-upah").textContent = totalUpah.toFixed(2);
    }

    // Function untuk menangani submit form
    document.getElementById("overtime-form").addEventListener("submit", function (event) {
      event.preventDefault();

      const formData = new FormData(event.target);
      const data = Object.fromEntries(formData.entries());

      const { totalLembur, upahLembur } = calculateOvertime(data.in, data.out);

      const newOvertime = {
        nama: data.nama,
        totalLembur: totalLembur,
        upahLembur: upahLembur,
        keterangan: data.keterangan,
      };

      overtimeData.push(newOvertime);
      populateSummaryTable(overtimeData);
      event.target.reset();
    });

    // Function untuk mengonversi tabel ke file Excel
    function exportToExcel() {
      const table = document.getElementById("overtime-table");
      const wb = XLSX.utils.table_to_book(table, { sheet: "Sheet1" });
      XLSX.utils.book_append_sheet(wb, XLSX.utils.table_to_sheet(table), "Sheet1");

      // Membuat Total row menjadi bold
      const ws = wb.Sheets["Sheet1"];
      const range = XLSX.utils.decode_range(ws['!ref']);
      const totalRow = range.e.r;

      for (let C = range.s.c; C <= range.e.c; ++C) {
        const cellAddress = XLSX.utils.encode_cell({ r: totalRow, c: C });
        if (!ws[cellAddress]) continue;
        ws[cellAddress].s = {
          font: { bold: true }
        };
      }

      XLSX.writeFile(wb, "Summary_Lembur.xlsx");
    }

    // Initialize DataTable dengan tombol-tombol
    $(document).ready(function() {
      const table = $('#overtime-table').DataTable({
        dom: 'Bfrtip',
        buttons: [
          {
            extend: 'print',
            title: 'Summary Lembur Karyawan',
            messageTop: 'Tanggal: 12 Juli 2024',
            messageBottom: 'Alamat: Jalan Example No.123, Jakarta\nApproved by: Manager Name'
          },
          {
            extend: 'csv',
            title: 'Summary_Lembur_Karyawan',
            filename: 'Summary_Lembur_Karyawan'
          },
          'copy',
          'colvis'
        ]
      });

      $('#print-btn').on('click', function() {
        table.button('.buttons-print').trigger();
      });

      $('#csv-btn').on('click', function() {
        table.button('.buttons-csv').trigger();
      });

      $('#copy-btn').on('click', function() {
        table.button('.buttons-copy').trigger();
      });

      $('#colvis-btn').on('click', function() {
        table.button('.buttons-colvis').trigger();
      });
    });

    // Populate table on page load
    document.addEventListener("DOMContentLoaded", () => {
      populateSummaryTable(overtimeData);
    });
  </script>
</body>
</html>
